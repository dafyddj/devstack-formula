#!/bin/bash
####################
## Managed by Salt
#####################

[[local|localrc]]
HOST_IP=${HOST_IP:-{{ devstack.local.host_ipv4 }}}
HOST_IPV6=${HOST_IPV6:-{{ devstack.local.host_ipv6 }}}
HOST_NAME={{ grains.host if not devstack.local.host_name else devstack.local.host_name }}
SERVICE_HOST=${SERVICE_HOST:-$HOST_IP}
MYSQL_HOST=${MYSQL_HOST:-{{ devstack.local.db_host or '127.0.0.1' }}}
DATABASE_HOST=${DATABASE_HOST:-{{ devstack.local.db_host or '127.0.0.1' }}}
RABBIT_HOST=${RABBIT_HOST:-$HOST_IP}
GLANCE_HOSTPORT=${GLANCE_HOSTPORT:-$HOST_IP:9292}

ENABLED_SERVICES={{ devstack.local.enabled_services or "" }}
DEST=${DEST:-{{ "/opt/stack" if not devstack.dir.dest else devstack.dir.dest }}}
DATA_DIR=${DATA_DIR:-{{ '/opt/stack' if not devstack.dir.dest else devstack.dir.dest }}/data}

GIT_BASE=${GIT_BASE:-{{ "https://git.openstack.org" if not devstack.local.git_base else devstack.local.git_base }}}
GIT_BRANCH=${GIT_BRANCH:-{{ "master" if not devstack.local.git_branch else devstack.local.git_branch }}}
RECLONE={{ devstack.local.reclone or "no" }}

# If the ``*_PASSWORD`` variables are not set here you will be prompted to enter ..
ADMIN_PASSWORD=${ADMIN_PASSWORD:-{{ devstack.local.admin_password or "nomoresecret" }}}
SERVICE_PASSWORD=${ADMIN_PASSWORD}
DATABASE_PASSWORD=${DATABASE_PASSWORD:-{{ devstack.local.database_password or "stackdb" }}}
RABBIT_PASSWORD=${RABBIT_PASSWORD:-{{ devstack.local.rabbit_password or "stackqueue" }}}
SERVICE_PASSWORD=${ADMIN_PASSWORD}
SERVICE_TOKEN=${SERVICE_TOKEN:-{{ devstack.local.service_token or "nomoresecret" }}}

# Logging
# -------
LOGFILE={{ devstack.dir.log or "${DEST}/logs" }}/{{ devstack.local.logfile }}
VERBOSE={{ devstack.local.verbose or "" }}
ENABLE_DEBUG_LOG_LEVEL={{ devstack.local.enable_debug_log_level or "" }}
ENABLE_VERBOSE_LOG_LEVEL={{ devstack.local.enable_verbose_log_level or "" }}

# Old log files are automatically removed after 7 days to keep things neat.  Change
# the number of days by setting ``LOGDAYS``.
LOGDAYS={{ devstack.local.logdays or "2" }}

# Nova logs will be colorized if ``SYSLOG`` is not set; turn this off by setting false.
LOG_COLOR={{ devstack.local.log_color or "True" }}

# Using branches
# --------------
CINDER_BRANCH=${CINDER_BRANCH:-{{ devstack.local.cinder_branch or devstack.local.git_branch }}}
GLANCE_BRANCH=${GLANCE_BRANCH:-{{ devstack.local.glance_branch or devstack.local.git_branch }}}
HORIZON_BRANCH=${HORIZON_BRANCH:-{{ devstack.local.horizon_branch or devstack.local.git_branch }}}
KEYSTONE_BRANCH=${KEYSTONE_BRANCH:-{{ devstack.local.keystone_branch or devstack.local.git_branch }}}
KEYSTONECLIENT_BRANCH=${KEYSTONECLIENT_BRANCH:-{{ devstack.local.keystoneclient_branch or devstack.local.git_branch }}}
NOVA_BRANCH=${NOVA_BRANCH:-{{ devstack.local.nova_branch or devstack.local.git_branch }}}
NOVACLIENT_BRANCH=${NOVACLIENT_BRANCH:-{{ devstack.local.novaclient_branch or devstack.local.git_branch }}}
NEUTRON_BRANCH=${NEUTRON_BRANCH:-{{ devstack.local.neutron_branch or devstack.local.git_branch }}}
SWIFT_BRANCH=${SWIFT_BRANCH:-{{ devstack.local.swift_branch or devstack.local.git_branch }}}

# Swift
# -----
SWIFT_HASH='66a3d6b56c1f479c8b4e70ab5c2000f5'
# For development purposes the default of 3 replicas is usually not required.
SWIFT_REPLICAS='1'

## Neutron
# -----
Q_USE_SECGROUP=${Q_USE_SECGROUP:-True}
FLOATING_RANGE=${FLOATING_RANGE:-}
IPV4_ADDRS_SAFE_TO_USE=${IPV4_ADDRS_SAFE_TO_USE:-}
Q_FLOATING_ALLOCATION_POOL=${Q_FLOATING_ALLOCATION_POOL:-}
PUBLIC_NETWORK_GATEWAY=${PUBLIC_NETWORK_GATEWAY:-{{ grains.ip4_gw }}}
PUBLIC_INTERFACE=${PUBLIC_INTERFACE:-}

# Open vSwitch provider networking configuration
Q_USE_PROVIDERNET_FOR_PUBLIC=${Q_USE_PROVIDERNET_FOR_PUBLIC:-True}
OVS_PHYSICAL_BRIDGE=${OVS_PHYSICAL_BRIDGE:-br-ex}
PUBLIC_BRIDGE=${OVS_PHYSICAL_BRIDGE:-br-ex}
OVS_BRIDGE_MAPPINGS=${OVS_BRIDGE_MAPPINGS:-public:br-ex}

ODL_MGR_IP=${HOST_IP:-'127.0.0.1' }}}

# Used by openrc
#---------------
# Ref: https://docs.openstack.org/devstack/latest/configuration.html#local-conf
OS_PASSWORD=${OS_PASSWORD:{{ devstack.local.os_password or "$ADMIN_PASSWORD" }}}
